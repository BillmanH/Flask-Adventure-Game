<script id="terrain-texture">

mapData['area']['Terrain Textures'] = terrData["Terrain Textures"]


//tool tip should work for all terrain objects
var terrain_tooltip = d3.select("body")
	.append("div")
	.attr("id", "terrain-info")                
	.style("position", "absolute")
	.style("z-index", "10")
	.style("visibility", "hidden")
	.html("<p>Default Text</p>");

//spin through the list of big objects and create
for (item in mapData['area']['Terrain Textures']){
	t = mapData['area']['Terrain Textures'][item]  //loading the current terrain object to t to save text
	//console.log("T= ",t)

	
	//take imput paramerter from t and create an array of data objets for D3. 
	data = []
	for (i=0;i<t['abundance'];i++) {
		cord = get_rnd_coord()
		t.spawnOrigin_x = cord[0]
		t.spawnOrigin_y = cord[1]
		data.push(JSON.parse(JSON.stringify(t)))
	}
	//console.log("data= ",data)
	switch(t['spread']){
		case 'scatter':
	        var elem = canvas.selectAll(t['name'])  
        	        .data(data)
                	        .enter()
                        	.append("circle")
   	                     .style('z-index',8)
        	                .attr("cx",function(d){return d.spawnOrigin_x})
                	        .attr("cy",function(d){return d.spawnOrigin_y})
                        	.attr("affect",function(d){return d.affect})
	                        .attr("affectText",function(d){return d.affectText})
        	                .attr("affectAmt",function(d){return d.affectAmt})
                	        .attr("name",function(d){return d.name})
                        	.classed("terrain", true)
	                        .attr("r",function(d){return d.size})
        	                .style("fill",function(d){return d.hex})
                	        .on("mouseover", function(d){
 	                                return terrain_tooltip.style("visibility", "visible")
      	                                        .html(d.name);
                			                        })
     	                       .on("mousemove", function(d){
                                        return terrain_tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px")
                                                .html(d.name);
                                        })
 		               .on("mouseout", function(){
                                        return terrain_tooltip.style("visibility", "hidden");
                                        });

			break;
		case "line":
                var elem = canvas.selectAll(t['name'])  
                        .data(data)
                                .enter()
                                .append("circle")
                             .style('z-index',8)
                                .attr("cx",function(d){return d.spawnOrigin_x})
                                .attr("cy",function(d){return d.spawnOrigin_y})
                                .attr("affect",function(d){return d.affect})
                                .attr("affectText",function(d){return d.affectText})
                                .attr("affectAmt",function(d){return d.affectAmt})
                                .attr("name",function(d){return d.name})
                                .classed("terrain", true)
                                .attr("r",function(d){return d.size})
                                .style("fill",function(d){return d.hex})
                                .on("mouseover", function(d){
                                        return terrain_tooltip.style("visibility", "visible")
                                                .html(d.name);
                                                                })
                               .on("mousemove", function(d){
                                        return terrain_tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px")
                                                .html(d.name);
                                        })
                               .on("mouseout", function(){
                                        return terrain_tooltip.style("visibility", "hidden");
                                        });

			break;
		case "jitter":
                var elem = canvas.selectAll(t['name'])  
                        .data(data)
                                .enter()
                                .append("circle")
                             .style('z-index',8)
                                .attr("cx",function(d){return d.spawnOrigin_x})
                                .attr("cy",function(d){return d.spawnOrigin_y})
                                .attr("affect",function(d){return d.affect})
                                .attr("affectText",function(d){return d.affectText})
                                .attr("affectAmt",function(d){return d.affectAmt})
                                .attr("name",function(d){return d.name})
                                .classed("terrain", true)
                                .attr("r",function(d){return d.size})
                                .style("fill",function(d){return d.hex})
                                .on("mouseover", function(d){
                                        return terrain_tooltip.style("visibility", "visible")
                                                .html(d.name);
                                                                })
                               .on("mousemove", function(d){
                                        return terrain_tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px")
                                                .html(d.name);
                                        })
                               .on("mouseout", function(){
                                        return terrain_tooltip.style("visibility", "hidden");
                                        });
			break;
		default:
//Assumiming that if there is no spread type, just place it randomly, terrain['density'] is ignored
			console.log('ERROR: a terrain item with no [spread] type was found. : ',t['name'],":",t['spread']);
                var elem = canvas.selectAll(t['name'])  
                        .data(data)
                                .enter()
                                .append("circle")
                             .style('z-index',8)
                                .attr("cx",function(d){return d.spawnOrigin_x})
                                .attr("cy",function(d){return d.spawnOrigin_y})
                                .attr("affect",function(d){return d.affect})
                                .attr("affectText",function(d){return d.affectText})
                                .attr("affectAmt",function(d){return d.affectAmt})
                                .attr("name",function(d){return d.name})
                                .classed("terrain", true)
                                .attr("r",function(d){return d.size})
                                .style("fill",function(d){return d.hex})
                                .on("mouseover", function(d){
                                        return terrain_tooltip.style("visibility", "visible")
                                                .html(d.name);
                                                                })
                               .on("mousemove", function(d){
                                        return terrain_tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px")
                                                .html(d.name);
                                        })
                               .on("mouseout", function(){
                                        return terrain_tooltip.style("visibility", "hidden");
                                        });
	}
}


</script>
